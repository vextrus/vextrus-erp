# MCP Server Configuration Guide

Modern MCP configuration for Vextrus ERP using Claude Code's native @ syntax for on-demand server enabling.

## Quick Reference

### Enabled by Default (Balanced Core)
- **sequential-thinking** - Deep reasoning (~1.5k tokens)
- **filesystem** - File operations (~1.5k tokens)
- **postgres** - Database queries (~1.5k tokens)

**Baseline context:** ~4-5k tokens (2-3% of 200k budget)

### Enable On-Demand with @ Syntax

Type `@servername` in any conversation to toggle servers:

```
@github           Enable GitHub (PR/issues/repo management)
@docker           Enable Docker (container operations)
@playwright       Enable Playwright (E2E testing)
@brave-search     Enable Brave Search (web research)
@context7         Enable Context7 (library docs lookup)
@consult7         Enable Consult7 (AI code consultation)
@serena           Enable Serena (code intelligence)
@memory           Enable Memory (persistent conversation memory)
@prisma-local     Enable Prisma Local (schema migrations)
@prisma-remote    Enable Prisma Remote (hosted schema service)
@sqlite           Enable SQLite (local database queries)
@brightdata       Enable BrightData (web scraping)
@notion           Enable Notion (workspace integration)
@reddit           Enable Reddit (Reddit API access)
```

**Context impact:** Each server adds ~1-3k tokens when enabled

---

## Configuration Files

### `.mcp.json` (Server Definitions)
Contains 17 MCP server configurations. Defines HOW to run each server (command, args, env).

**Location:** `C:\Users\riz\vextrus-erp\.mcp.json`

**Structure:**
```json
{
  "mcpServers": {
    "servername": {
      "type": "stdio",
      "command": "cmd",
      "args": ["/c", "npx", "-y", "@package/server"],
      "env": { "API_KEY": "..." }
    }
  }
}
```

**Note:** NO "disabled" field (non-standard). Enable/disable is controlled elsewhere.

---

### `.claude/settings.local.json` (Enable/Disable Control)
Controls which servers load at startup and which stay dormant.

**Location:** `C:\Users\riz\vextrus-erp\.claude\settings.local.json`

**Current config (Balanced):**
```json
{
  "enabledMcpjsonServers": [
    "sequential-thinking",
    "filesystem",
    "postgres"
  ],
  "disabledMcpjsonServers": [
    "context7", "consult7", "docker", "playwright",
    "brave-search", "serena", "github", "memory",
    "prisma-local", "prisma-remote", "sqlite",
    "brightdata", "notion", "reddit"
  ]
}
```

**To change defaults:** Edit this file, restart Claude Code

---

## Usage Patterns

### Pattern 1: Daily Development (Default)
```
Start session → 3 servers enabled (4-5k tokens)
Work on features → Use native CC tools (Read, Edit, Bash)
Need database → @postgres already enabled ✓
Need GitHub → Type @github to enable
Done with GitHub → Type @github to disable
```

### Pattern 2: Frontend Testing
```
Start session → 3 core servers
Need E2E testing → Type @playwright
Write tests → Playwright tools available
Done → Type @playwright to disable
```

### Pattern 3: Research & Documentation
```
Need library docs → @context7
Need web search → @brave-search
Need AI consultation → @consult7
Done → Disable each with @ syntax
```

---

## Context Budget Management

### Baseline (Current Config)
- System prompt: ~2.5k (1.3%)
- System tools: ~21.7k (10.8%)
- Custom agents: ~4.7k (2.4%)
- Memory (CLAUDE.md): ~7.1k (3.6%)
- **MCP servers: ~4-5k (2-3%)** ← Balanced core
- **Available for work: ~160k (80%)**

### With Additional Servers Enabled
| Config | MCP Tokens | % of 200k | Available |
|--------|-----------|-----------|-----------|
| Minimal (thinking only) | ~1.5k | 0.75% | ~198k (99%) |
| **Balanced (current)** | ~4-5k | 2-3% | ~160k (80%) |
| + GitHub + Docker | ~8-10k | 4-5% | ~155k (77%) |
| All 17 servers | ~35-40k | 18-20% | ~125k (62%) |

**Target per CLAUDE.md V7.0:** Keep baseline <50k (25%), leaving 150k (75%) for work

---

## Best Practices

### ✅ DO

1. **Start minimal** - Use balanced core (3 servers)
2. **Enable on-demand** - Type @ when you need specific tools
3. **Disable when done** - Type @ again to toggle off
4. **Monitor context** - Use `/context` command regularly
5. **Restart when changing defaults** - Edit settings.local.json → restart

### ❌ DON'T

1. **Enable all servers** - Wastes 35-40k context unnecessarily
2. **Edit .mcp.json unless needed** - Server definitions rarely change
3. **Add "disabled" field** - Non-standard, use settings.local.json
4. **Forget to disable** - Servers stay enabled until toggled

---

## Troubleshooting

### Problem: MCP servers not appearing
**Solution:** Check `.claude/settings.local.json` → ensure servers are in `enabledMcpjsonServers`

### Problem: @ syntax not working
**Solution:** Verify server name matches exactly (case-sensitive)

### Problem: Context too high
**Solution:** Disable unused servers with @ syntax, or edit settings.local.json

### Problem: Server fails to start
**Solution:** Check `.mcp.json` for correct paths/commands, especially Windows paths

---

**Updated:** 2025-10-30 (V7.0 Phase-Based Native Orchestration)
**Config:** Balanced core (sequential-thinking + filesystem + postgres)
**Approach:** Native @ syntax for runtime toggling
