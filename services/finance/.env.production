# Finance Module Production Environment Configuration
# Optimized for 50,000+ concurrent users and < 100ms response times
# Bangladesh ERP Compliance Ready

#################################
# SERVICE CONFIGURATION
#################################
NODE_ENV=production
PORT=3014
SERVICE_NAME=finance-service
API_PREFIX=/api/finance
CORS_ORIGIN=https://erp.vextrus.com,https://api.vextrus.com
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

#################################
# DATABASE CONFIGURATION
#################################
# Primary Database
DATABASE_HOST=prod-db.vextrus.com
DATABASE_PORT=5432
DATABASE_USERNAME=finance_user
DATABASE_PASSWORD=${DB_PASSWORD_ENCRYPTED}
DATABASE_NAME=vextrus_finance
DATABASE_SSL=true
DATABASE_POOL_MIN=10
DATABASE_POOL_MAX=100
DATABASE_POOL_IDLE_TIMEOUT_MS=30000
DATABASE_CONNECTION_TIMEOUT_MS=5000
DATABASE_STATEMENT_TIMEOUT_MS=30000

# Read Replica Configuration
DATABASE_READ_REPLICA_HOST=prod-db-read.vextrus.com
DATABASE_READ_REPLICA_PORT=5432
DATABASE_READ_REPLICA_POOL_MAX=200

#################################
# EVENT STORE CONFIGURATION
#################################
EVENTSTORE_CONNECTION_STRING=esdb://prod-eventstore.vextrus.com:2113?tls=true
EVENTSTORE_ADMIN_USERNAME=admin
EVENTSTORE_ADMIN_PASSWORD=${EVENTSTORE_PASSWORD_ENCRYPTED}
EVENTSTORE_MAX_APPEND_SIZE=1048576
EVENTSTORE_DEFAULT_USER_CREDENTIALS=true

#################################
# REDIS CONFIGURATION
#################################
REDIS_HOST=prod-redis.vextrus.com
REDIS_PORT=6379
REDIS_PASSWORD=${REDIS_PASSWORD_ENCRYPTED}
REDIS_DB=0
REDIS_KEY_PREFIX=finance:
REDIS_TTL=300
REDIS_CLUSTER_ENABLED=true
REDIS_CLUSTER_NODES=prod-redis-1.vextrus.com:6379,prod-redis-2.vextrus.com:6379,prod-redis-3.vextrus.com:6379
REDIS_SENTINEL_ENABLED=true
REDIS_SENTINEL_MASTER=mymaster
REDIS_SENTINEL_NODES=sentinel-1.vextrus.com:26379,sentinel-2.vextrus.com:26379,sentinel-3.vextrus.com:26379

#################################
# KAFKA CONFIGURATION
#################################
KAFKA_BROKERS=prod-kafka-1.vextrus.com:9092,prod-kafka-2.vextrus.com:9092,prod-kafka-3.vextrus.com:9092
KAFKA_CLIENT_ID=finance-service-prod
KAFKA_GROUP_ID=finance-consumer-group
KAFKA_SASL_ENABLED=true
KAFKA_SASL_MECHANISM=SCRAM-SHA-512
KAFKA_SASL_USERNAME=finance_service
KAFKA_SASL_PASSWORD=${KAFKA_PASSWORD_ENCRYPTED}
KAFKA_SSL_ENABLED=true
KAFKA_AUTO_OFFSET_RESET=earliest
KAFKA_SESSION_TIMEOUT_MS=30000
KAFKA_HEARTBEAT_INTERVAL_MS=3000

#################################
# AUTHENTICATION & SECURITY
#################################
JWT_SECRET=${JWT_SECRET_ENCRYPTED}
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d
ENCRYPTION_KEY=${ENCRYPTION_KEY_ENCRYPTED}
ENCRYPTION_ALGORITHM=aes-256-gcm
BCRYPT_ROUNDS=12

# OAuth Configuration
OAUTH_ENABLED=true
OAUTH_PROVIDER=https://auth.vextrus.com
OAUTH_CLIENT_ID=finance-service
OAUTH_CLIENT_SECRET=${OAUTH_SECRET_ENCRYPTED}

# API Keys
API_KEY_HEADER=X-API-Key
API_KEYS_ENABLED=true
API_RATE_LIMIT_PER_KEY=1000

#################################
# BANGLADESH COMPLIANCE
#################################
# NBR (National Board of Revenue)
NBR_API_URL=https://nbr.gov.bd/api/v1
NBR_API_KEY=${NBR_API_KEY_ENCRYPTED}
NBR_TIN_VALIDATION_URL=https://nbr.gov.bd/api/v1/tin/validate
NBR_VAT_SUBMISSION_URL=https://nbr.gov.bd/api/v1/vat/submit

# VAT Configuration
VAT_RATE=0.15
VAT_REGISTRATION_THRESHOLD=3000000
VAT_FILING_FREQUENCY=monthly
VAT_LATE_PENALTY_RATE=0.02

# Tax Configuration
TAX_YEAR_START=07-01
TAX_YEAR_END=06-30
TDS_RATE=0.05
AIT_RATE=0.003
CORPORATE_TAX_RATE=0.275

# RAJUK Integration
RAJUK_API_URL=https://rajuk.gov.bd/api/v1
RAJUK_API_KEY=${RAJUK_API_KEY_ENCRYPTED}

# Banking Integration
BANGLADESH_BANK_API_URL=https://bb.org.bd/api/v1
BB_API_KEY=${BB_API_KEY_ENCRYPTED}
INTERBANK_TRANSFER_ENABLED=true

#################################
# PAYMENT GATEWAYS
#################################
# bKash
BKASH_ENABLED=true
BKASH_APP_KEY=${BKASH_APP_KEY_ENCRYPTED}
BKASH_APP_SECRET=${BKASH_APP_SECRET_ENCRYPTED}
BKASH_USERNAME=finance_service
BKASH_PASSWORD=${BKASH_PASSWORD_ENCRYPTED}
BKASH_API_URL=https://tokenized.pay.bka.sh/v1.2.0-beta

# Nagad
NAGAD_ENABLED=true
NAGAD_MERCHANT_ID=683002007104225
NAGAD_PUBLIC_KEY=${NAGAD_PUBLIC_KEY_ENCRYPTED}
NAGAD_PRIVATE_KEY=${NAGAD_PRIVATE_KEY_ENCRYPTED}
NAGAD_API_URL=https://api.mynagad.com

# SSLCommerz
SSLCOMMERZ_ENABLED=true
SSLCOMMERZ_STORE_ID=vextr5ff8d3b6a8e9f
SSLCOMMERZ_STORE_PASSWORD=${SSLCOMMERZ_PASSWORD_ENCRYPTED}
SSLCOMMERZ_API_URL=https://securepay.sslcommerz.com

#################################
# MONITORING & OBSERVABILITY
#################################
# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=https://otel-collector.vextrus.com:4318
OTEL_EXPORTER_OTLP_HEADERS=Authorization=Bearer ${OTEL_TOKEN}
OTEL_SERVICE_NAME=finance-service
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1
OTEL_METRICS_EXPORTER=prometheus
OTEL_LOGS_EXPORTER=otlp

# Prometheus
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_PATH=/metrics
PROMETHEUS_PREFIX=finance_

# Grafana
GRAFANA_ENABLED=true
GRAFANA_URL=https://grafana.vextrus.com
GRAFANA_API_KEY=${GRAFANA_API_KEY_ENCRYPTED}

# Sentry
SENTRY_DSN=https://abc123@sentry.vextrus.com/finance
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_ATTACH_STACKTRACE=true

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
LOG_OUTPUT=stdout
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/var/log/finance-service/app.log
LOG_FILE_MAX_SIZE=100M
LOG_FILE_MAX_FILES=10
LOG_ELASTICSEARCH_ENABLED=true
LOG_ELASTICSEARCH_URL=https://elastic.vextrus.com:9200
LOG_ELASTICSEARCH_INDEX=finance-logs

#################################
# PERFORMANCE OPTIMIZATION
#################################
# Node.js Configuration
NODE_OPTIONS=--max-old-space-size=4096 --max-semi-space-size=256
UV_THREADPOOL_SIZE=128
CLUSTER_WORKERS=0  # 0 = auto (number of CPU cores)

# Caching
CACHE_ENABLED=true
CACHE_TTL=300
CACHE_MAX_KEYS=10000
CACHE_CHECK_PERIOD=600
CACHE_REDIS_DB=1

# Query Optimization
QUERY_CACHE_ENABLED=true
QUERY_CACHE_TTL=60
MATERIALIZED_VIEWS_ENABLED=true
MATERIALIZED_VIEW_REFRESH_INTERVAL=3600000

# Connection Pooling
CONNECTION_POOL_MIN=10
CONNECTION_POOL_MAX=100
CONNECTION_POOL_ACQUIRE_TIMEOUT=30000
CONNECTION_POOL_IDLE_TIMEOUT=10000

#################################
# FILE STORAGE
#################################
# S3 Compatible Storage
S3_ENABLED=true
S3_ENDPOINT=https://s3.vextrus.com
S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ENCRYPTED}
S3_SECRET_ACCESS_KEY=${S3_SECRET_KEY_ENCRYPTED}
S3_BUCKET_NAME=vextrus-finance
S3_REGION=ap-south-1
S3_SIGNATURE_VERSION=v4
S3_FORCE_PATH_STYLE=false

# Local Storage Fallback
LOCAL_STORAGE_PATH=/mnt/storage/finance
LOCAL_STORAGE_MAX_SIZE=10GB
TEMP_UPLOAD_PATH=/tmp/finance-uploads

#################################
# EMAIL CONFIGURATION
#################################
SMTP_ENABLED=true
SMTP_HOST=smtp.vextrus.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=finance@vextrus.com
SMTP_PASSWORD=${SMTP_PASSWORD_ENCRYPTED}
EMAIL_FROM_NAME=Vextrus Finance
EMAIL_FROM_ADDRESS=finance@vextrus.com

#################################
# FEATURE FLAGS
#################################
FEATURE_NEW_DASHBOARD=true
FEATURE_ML_PREDICTIONS=true
FEATURE_REALTIME_KPI=true
FEATURE_BANGLADESH_COMPLIANCE=true
FEATURE_MULTI_CURRENCY=true
FEATURE_AUDIT_TRAIL=true
FEATURE_EVENT_SOURCING=true
FEATURE_WEBHOOK_NOTIFICATIONS=true

#################################
# WEBHOOK CONFIGURATION
#################################
WEBHOOK_ENABLED=true
WEBHOOK_TIMEOUT_MS=10000
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY_MS=5000

#################################
# RATE LIMITING
#################################
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false
RATE_LIMIT_SKIP_FAILED_REQUESTS=false
RATE_LIMIT_KEY_PREFIX=rl:

#################################
# SECURITY HEADERS
#################################
HELMET_ENABLED=true
CORS_ENABLED=true
CORS_CREDENTIALS=true
CORS_METHODS=GET,HEAD,PUT,PATCH,POST,DELETE
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-API-Key,X-Tenant-Id
CORS_EXPOSED_HEADERS=X-Total-Count,X-Page-Count
CORS_MAX_AGE=86400

#################################
# MULTI-TENANCY
#################################
MULTI_TENANCY_ENABLED=true
TENANT_HEADER=X-Tenant-Id
TENANT_ISOLATION=schema
DEFAULT_TENANT=default

#################################
# BACKUP & DISASTER RECOVERY
#################################
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=vextrus-backups
DISASTER_RECOVERY_RTO_HOURS=4
DISASTER_RECOVERY_RPO_HOURS=1

#################################
# AUDIT & COMPLIANCE
#################################
AUDIT_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=2555  # 7 years for financial compliance
AUDIT_SENSITIVE_DATA_MASKING=true
COMPLIANCE_MODE=strict
PCI_DSS_ENABLED=true
ISO_27001_ENABLED=true

#################################
# MAINTENANCE MODE
#################################
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=System is under maintenance. Please try again later.
MAINTENANCE_ALLOWED_IPS=

#################################
# DEBUG (Disable in production)
#################################
DEBUG=false
DEBUG_SQL=false
DEBUG_CACHE=false
DEBUG_EVENTS=false

# End of Finance Module Production Configuration